<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Furry Badges</title>
    <link href="//fonts.googleapis.com/css?family=Rubik:300,400,500,700" rel="stylesheet" type="text/css"/>
    <link href="//cdn.muicss.com/mui-0.10.3/css/mui.min.css" rel="stylesheet" type="text/css"/>
    <script src="//cdn.muicss.com/mui-0.10.3/js/mui.min.js"></script>
    <style>
        body {
            font-family: Rubik, -apple-system, sans-serif;
        }
    </style>
</head>
<body>
<div style="max-width: 600px; margin: auto">
    <div style="margin: 20px">
        <div id="sourceBadge">
            <a href="https://github.com/FurryCoders/furry-badges">
                <img src="https://img.shields.io/badge/Source-GitHub-blue?logo=github" alt=""></a>
        </div>
        <br>
        <div class="mui-form">
            <div class="mui--text-title">Furry Badges</div>
            <div class="mui-select">
                <select id="site" onchange="updateBadge()" required>
                    <option value="" disabled hidden selected>Select site</option>
                    {% for site in sites %}
                    <option value="{{ site }}">{{ site }}</option>
                    {% endfor %}
                </select>
                <label for="site">Site</label>
            </div>
            <div class="mui-textfield mui-textfield--float-label">
                <input id="label" type="text" oninput="updateBadge()" value="">
                <label for="label">Label</label>
            </div>
            <div class="mui-checkbox">
                <label>
                    <input type="checkbox" id="noLabel" value=""
                           onclick="$('label').disabled = this.checked; updateBadge()">
                    No label
                </label>
            </div>
            <div class="mui-textfield mui-textfield--float-label">
                <input id="username" type="text" oninput="updateBadge()" value="" required>
                <label for="username">Username</label>
            </div>
        </div>
        <br><br>
        <div id="badgeContainer" style="text-align: center; cursor: pointer !important;" hidden>
            <a id="badgeURL" href=""><img id="badge" src="" alt=""></a>
        </div>
        <br><br>
        <div id="copyMarkupContainer" hidden>
            <div class="mui-select" style="max-width: 300px; margin: auto">
                <select id="copyMarkup" onchange="copyMarkup(this.value); this.selectedIndex = 0">
                    <option value="" disabled hidden selected>Copy URL & Markup</option>
                    <option value="url">Badge URL</option>
                    <option value="markdown">Markdown</option>
                    <option value="asciidoc">AsciiDoc</option>
                    <option value="restructuredtext">reStructuredText</option>
                </select>
                <label for="copyMarkup"></label>
            </div>
        </div>
    </div>
</div>
<script>
    const root = "https://furry-badges.herokuapp.com" //window.location.origin
    const $ = (id) => document.getElementById(id)
    const updateBadge = () => {
        const site = $("site").value.trim()
        const label = $("label").value.trim()
        const username = $("username").value.trim()
        const noLabel = $("noLabel").checked
        let url
        if (!site || !username) url = ""
        else url = `/badge/user/${site}/${encodeURIComponent(username)}/${encodeURIComponent(noLabel ? "" : label)}` + (noLabel ? "?label=+" : "")
        $("badge").src = $("badgeURL").href = root + url
        $("badgeContainer").hidden = $("copyMarkupContainer").hidden = !url
    }
    const copyMarkup = (markup) => {
        if (markup === "url") navigator.clipboard.writeText($("badge").src)
        else if (markup === "markdown") navigator.clipboard.writeText(`![](${$("badge").src})`)
        else if (markup === "asciidoc") navigator.clipboard.writeText(`image::${$("badge").src}[]`)
        else if (markup === "restructuredtext") navigator.clipboard.writeText(`.. ${$("badge").src}`)
    }
</script>
</body>
</html>
